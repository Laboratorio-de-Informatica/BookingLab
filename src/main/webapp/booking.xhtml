<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition
    xmlns:ui="jakarta.faces.facelets"
    xmlns:f="jakarta.faces.core"
    xmlns:h="jakarta.faces.html"
    xmlns:p="http://primefaces.org/ui"
    template="/template.xhtml">
    <ui:define name="content"> 
        <div class="flex p-8 align-items-center flex-column">
            <p:outputPanel id="reservation" styleClass="w-full" rendered="#{not empty bookingController.booking}">
                <div class="font-medium text-3xl text-900 mb-3">Información de Reserva</div>
                <div class="text-500 mb-5">Ingrese los datos para crear una reserva.</div>
                <ul class="list-none p-0 m-0">
                    <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                        <p:outputLabel for="teacher" value="Profesor" styleClass="text-500 w-full md:w-2 font-medium" />
                        <p:inputText id="teacher" placeholder="Profesor" value="#{bookingController.booking.teacher}" required="true"  styleClass="text-500 w-20rem"/>
                    </li>
                    <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                        <p:outputLabel for="course" value="Curso" styleClass="text-500 w-full md:w-2 font-medium" />
                        <p:inputText id="course" placeholder="Materia" value="#{bookingController.booking.course}" required="true" styleClass="text-500 w-20rem"/>
                    </li>
                    <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                        <p:outputLabel for="laboratory" value="Laboratorio" styleClass="text-500 w-6 md:w-2 font-medium"/>
                        <p:selectOneMenu id="laboratory" required="true" styleClass="text-500 w-20rem" value="#{bookingController.booking.laboratory}" >
                            <f:selectItem itemLabel="Seleccionar Laboratorio" itemValue=""/>
                            <f:selectItems value="#{bookingController.laboratories}" var="lab" 
                                    itemValue="#{lab}" itemLabel="#{lab}" />
                        </p:selectOneMenu>
                    </li>
                    <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                        <p:outputLabel for="timeslotmin" value="Hora inicial" styleClass="text-500 w-6 md:w-2 font-medium" />
                        <p:datePicker id="timeslotmin" value="#{bookingController.booking.initialTimeSlot}"
                        mindate="#{bookingController.minTime}" maxdate="#{bookingController.maxTime}" timeOnly="true" pattern="HH:mm" hourFormat="12" required="true"/>
                    </li>
                    <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                        <p:outputLabel for="timeslotmax" value="Hora final" styleClass="text-500 w-6 md:w-2 font-medium" />
                        <p:datePicker id="timeslotmax" value="#{bookingController.booking.finalTimeSlot}"
                            mindate="#{bookingController.minTime}" maxdate="#{bookingController.maxTime}"  timeOnly="true" pattern="HH:mm" hourFormat="12" required="true" />
                    </li>
                    <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                        <p:outputLabel for="observation" value="Observaciones" styleClass="text-500 w-6 md:w-2 font-medium" />
                        <div class="flex flex-column gap-2 w-20rem">
                            <p:inputTextarea id="observation" rows="5" cols="30" counter="characters" maxlength="500"
                                            counterTemplate="{0} caracteres restantes" value="#{bookingController.booking.observation}"/>
                            <h:outputText id="characters" class="block" />
                        </div>
                    </li>
                    <li class="grid align-items-center py-3 px-2 border-top-1 surface-border">
                        <p:outputLabel value="Repetir" styleClass="text-500 w-6 md:w-2 font-medium col-6" />
                        <p:outputPanel>
                            <p:spinner value="#{durationController.repetitions}" 
                                upButtonStyleClass="ui-button-success" downButtonStyleClass="ui-button-danger" min="1">
                                <p:ajax event="change" update="summaryMessage" listener="#{durationController.updateSummaryMessage}"/>
                            </p:spinner>
                            <p:selectManyButton id="selectDaysButton" value="#{durationController.selectedDays}">
                                <f:selectItems value="#{durationController.days}" var="day" 
                                itemValue="#{day}" itemLabel="#{durationController.getDisplayNameOfDayOfWeek(day)}" />
                                <p:ajax event="change" update="summaryMessage" listener="#{durationController.updateSummaryMessage}"/>
                            </p:selectManyButton>
                            <p:outputLabel id="summaryMessage" styleClass=" font-bold ml-2" style="color: #990000;">
                                Este evento #{durationController.summaryMessage}
                            </p:outputLabel>
                        </p:outputPanel>
                    </li>
                    <li class="grid align-items-center py-3 px-2 border-top-1 surface-border">
                        <p:outputLabel for="duration" value="Duración" styleClass="text-500 w-6 md:w-2 font-medium" />
                        <p:spinner id="duration" value="#{durationController.duration}"
                            upButtonStyleClass="ui-button-success" downButtonStyleClass="ui-button-danger" min="1">
                            <p:ajax event="change" update="durationMessage" />
                        </p:spinner>
                        <p:outputLabel id="durationMessage" styleClass="font-bold ml-2" style="color: #990000;">
                            Este evento dura #{durationController.duration} #{durationController.duration == 1 ? 'vez' : 'veces'} en total
                        </p:outputLabel>
                    </li>
                </ul>
            </p:outputPanel>
            <p:outputPanel styleClass="flex gap-5">
                <p:commandButton value="Regresar" onclick="window.location.href='index.xhtml'"
                                      styleClass="btn-link ui-button-raised ui-button-secondary"/>  
                <p:commandButton value="Reservar" process="reservation @this" update="reservation :form"
                styleClass="btn-link ui-button-raised ui-button-success" actionListener="#{bookingController.saveReservation}"/>
            </p:outputPanel>
        </div>
    </ui:define>
</ui:composition>
