<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition
    xmlns:ui="jakarta.faces.facelets"
    xmlns:f="jakarta.faces.core"
    xmlns:h="jakarta.faces.html"
    xmlns:p="http://primefaces.org/ui"
    template="/template.xhtml">
    <ui:define name="content"> 
        <div class="flex p-8 align-items-center flex-column">
            <p:outputPanel id="reservation" class="surface-section w-full" rendered="#{not empty bookingController.booking}">
                <div class="font-medium text-3xl text-900 mb-3">Información de Reserva</div>
                <div class="text-500 mb-5">Ingrese los datos para crear una reserva.</div>
                <ul class="list-none p-0 m-0">
                    <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                        <p:outputLabel for="teacher" value="Profesor" styleClass="text-500 w-full md:w-2 font-medium" />
                        <p:inputText id="teacher" placeholder="#{loginController.userName}" value="#{bookingController.booking.teacher}" required="true"  styleClass="text-500 w-20rem"/>
                    </li>
                    <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                        <p:outputLabel for="course" value="Curso" styleClass="text-500 w-full md:w-2 font-medium" />
                        <p:inputText id="course" placeholder="Materia" value="#{bookingController.booking.course}" required="true" styleClass="text-500 w-20rem"/>
                    </li>
                    <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                        <p:outputLabel for="laboratory" value="Laboratorio" styleClass="text-500 w-6 md:w-2 font-medium"/>
                        <p:selectOneMenu id="laboratory" required="true" styleClass="text-500 w-20rem" value="#{bookingController.booking.laboratory}" >
                            <f:selectItem itemLabel="Seleccionar Laboratorio" itemValue=""/>
                            <f:selectItems value="#{bookingController.laboratories}" var="lab" 
                                    itemValue="#{lab}" itemLabel="#{lab}" />
                        </p:selectOneMenu>
                    </li>
                    <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                        <p:outputLabel for="timeslotmin" value="Hora inicial" styleClass="text-500 w-6 md:w-2 font-medium" />
                        <p:datePicker id="timeslotmin" value="#{bookingController.booking.initialTimeSlot}"
                        mindate="#{bookingController.minTime}" maxdate="#{bookingController.maxTime}" timeOnly="true" pattern="HH:mm" hourFormat="12" required="true"/>
                    </li>
                    <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                        <p:outputLabel for="timeslotmax" value="Hora final" styleClass="text-500 w-6 md:w-2 font-medium" />
                        <p:datePicker id="timeslotmax" value="#{bookingController.booking.finalTimeSlot}"
                            mindate="#{bookingController.minTime}" maxdate="#{bookingController.maxTime}"  timeOnly="true" pattern="HH:mm" hourFormat="12" required="true" />
                    </li>
                    <li class="flex align-items-center py-3 px-2 border-top-1 surface-border flex-wrap">
                        <p:outputLabel for="observation" value="Observaciones" styleClass="text-500 w-6 md:w-2 font-medium" />
                        <div class="flex flex-column gap-2 w-20rem">
                            <p:inputTextarea id="observation" rows="5" cols="30" counter="characters" maxlength="500"
                                            counterTemplate="{0} caracteres restantes" value="#{bookingController.booking.observation}"/>
                            <h:outputText id="characters" class="block" />
                        </div>
                    </li>
                    <li class="grid align-items-center py-3 px-2 border-top-1 surface-border">
                        <p:outputLabel value="Repetir" styleClass="text-500 w-6 md:w-2 font-medium col-6" />
                        <p:selectOneRadio value="#{durationController.selectedOption}" layout="responsive" columns="3" styleClass="col-6">
                            <f:selectItem itemLabel="No repetir" itemValue="0" />
                            <f:selectItem itemLabel="Cada día" itemValue="1">
                            </f:selectItem>
                            <f:selectItem itemLabel="Cada semana" itemValue="2"/>
                            <p:ajax event="change" update="seccionARenderizar durationpanel" />
                            <p:ajax event="change" update="summaryMessage" listener="#{durationController.updateSummaryMessage}"/>
                        </p:selectOneRadio>
                        <p:outputPanel id="seccionARenderizar" styleClass="w-full flex" >
                            <p:outputPanel rendered="#{durationController.selectedOption != 0}" styleClass="col-2">
                                <p:spinner value="#{durationController.duration.repetitions}" 
                                    upButtonStyleClass="ui-button-success" downButtonStyleClass="ui-button-danger" min="1">
                                    <p:ajax event="change" update="summaryMessage" listener="#{durationController.updateSummaryMessage}"/>
                                </p:spinner>
                            </p:outputPanel>
                            <p:outputPanel rendered="#{durationController.selectedOption == 2}" styleClass="col-10 w-full">
                                <p:selectManyButton id="selectDaysButton" value="#{durationController.duration.selectedDays}">
                                    <f:selectItems value="#{durationController.days}" var="day" 
                                    itemValue="#{day}" itemLabel="#{day}" />
                                    <p:ajax event="change" update="summaryMessage" listener="#{durationController.updateSummaryMessage}"/>
                                </p:selectManyButton>
                            </p:outputPanel>
                        </p:outputPanel>
                        <p:outputLabel id="summaryMessage" styleClass="text-red-500 font-bold ml-2">
                            Este evento #{durationController.summaryMessage}
                        </p:outputLabel>
                    </li>
                    <p:outputPanel id="durationpanel">
                        <p:outputPanel rendered="#{durationController.selectedOption != 0}">
                            <li class="grid align-items-center py-3 px-2 border-top-1 surface-border">
                                <p:outputLabel for="duration" value="Duración" styleClass="text-500 w-6 md:w-2 font-medium" />
                                <p:spinner id="duration" value="#{durationController.duration.duration}"
                                upButtonStyleClass="ui-button-success" downButtonStyleClass="ui-button-danger" min="1">
                                <p:ajax event="change" update="durationMessage" />
                                </p:spinner>
                                <p:outputLabel id="durationMessage" styleClass="text-red-500 font-bold ml-2">
                                    Este evento dura #{durationController.duration.duration} #{durationController.duration.duration == 1 ? 'vez' : 'veces'} en total
                                </p:outputLabel>
                            </li>
                        </p:outputPanel>
                    </p:outputPanel>
                </ul>
            </p:outputPanel>

            <p:commandButton value="Reservar" process="reservation @this" update="reservation :form"
            styleClass="btn-link ui-button-raised ui-button-success" actionListener="#{bookingController.saveReservation}"/>
        </div>
    </ui:define>
</ui:composition>
